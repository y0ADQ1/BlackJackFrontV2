<div class="container">
  @if (game) {
    <h2>Blackjack - Room {{ game.roomCode }}</h2>
    <p>Status: {{ game.status }}</p>
    <p>Players: {{ game.players.length }} / {{ game.maxPlayers }} (including host)</p>
    @if (game.status === 'waiting' && game.players.length < 5) {
      <p class="waiting-message">Waiting for {{ 5 - game.players.length }} more player(s) to start the game</p>
    }

    <!-- Notificación de unión (toast) -->
    @if (notificationMessage) {
      <div class="notification">
        {{ notificationMessage }}
      </div>
    }

    <!-- Mensaje de error -->
    @if (errorMessage) {
      <p class="error">{{ errorMessage }}</p>
    }

    <!-- Mensaje de fin de juego -->
    @if (gameEndedReason) {
      <p class="game-ended">Game Ended: {{ gameEndedReason }}</p>
    }

    <!-- Lista de jugadores -->
    <div class="players">
      <h3>Players</h3>
      @for (player of game.players; track player.id) {
        <div class="player">
          <p>{{ player.username }} (Position: {{ player.position }})</p>
          @if (player.isHost) {
            <p>Host</p>
          }
          @if (player.isCurrentTurn) {
            <p>Current Turn</p>
          }
          <p>Score: {{ player.totalScore ?? 'Hidden' }}</p>
          <p>Status: {{ player.wantsCards ? 'Playing' : 'Standing' }}</p>
          <div class="cards">
            @for (card of player.cards; track card.id) {
              <img [src]="!card.isVisible ? environment.assetsUrl + '/output_embedded.svg' : environment.assetsUrl + '/' + card.filename"
                  alt="{{ !card.isVisible ? 'Hidden Card' : card.value + ' of ' + card.suit }}"
                  class="card">
            }
          </div>
          @if (game.userPlayer?.isHost && !player.isCurrentTurn && player.wantsCards) {
            <button (click)="dealCard(player.id)">Deal Card</button>
          }
        </div>
      }
    </div>

    <!-- Acciones del jugador -->
    @if (game.userPlayer) {
      <div class="actions">
        @if (game.status === 'waiting' && game.userPlayer.isHost) {
          <button (click)="startGame()" [disabled]="game.players.length < 5">Start Game</button>
        }
        @if (game.status === 'playing' && game.userPlayer.isCurrentTurn && game.userPlayer.wantsCards) {
          <button (click)="requestCard()">Hit</button>
          <button (click)="skipTurn()">Stand</button>
        }
        @if (game.status === 'playing' && game.userPlayer.totalScore === 21 && !game.userPlayer.hasRequestedReveal) {
          <button (click)="requestReveal()">Request Reveal</button>
        }
        @if (game.status === 'finished' && game.userPlayer.isHost) {
          <button (click)="rematch()">Rematch</button>
        }
        <button (click)="leaveGame()">Leave Game</button>
      </div>
    }
  }
</div>